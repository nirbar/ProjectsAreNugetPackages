<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">

  <UsingTask TaskName="ResolveNugetReferences" AssemblyFile="$(MSBuildThisFileDirectory)\..\tools\MSBuildTasks.dll" />
  <Target Name="ResolveProjectReferences" DependsOnTargets="AssignProjectConfiguration">
    <ResolveNugetReferences PackagesConfig="$(MSBuildProjectDirectory)\packages.config">
      <Output TaskParameter="TargetOutputs" ItemName="_ResolvedProjectReferences" />
    </ResolveNugetReferences>

    <MSBuild Projects="@(_ResolvedProjectReferences)"
             Targets="GetTargetPath"
             Properties="Configuration=$(Configuration);Platform=$(Platform)"
             Condition="('$(BuildingSolutionFile)' == 'true' or '$(BuildingInsideVisualStudio)' == 'true' or '$(BuildProjectReferences)' != 'true') and '@(_ResolvedProjectReferences)' != '' "
             ContinueOnError="!$(BuildingProject)">
      <Output TaskParameter="TargetOutputs" ItemName="_GatheredProjectReferencePaths" />
    </MSBuild>
  </Target>
</Project>