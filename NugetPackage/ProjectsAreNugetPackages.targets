<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">

  <UsingTask TaskName="ResolveNugetReferences" AssemblyFile="$(MSBuildThisFileDirectory)\..\tools\MSBuildTasks.dll" />

  <Target Name="ResolveProjectReferences" DependsOnTargets="AssignProjectConfiguration">
    <ResolveNugetReferences PackagesConfig="$(MSBuildProjectDirectory)\packages.config" ProjectsBaseFolders="$(SolutionDir)">
      <Output TaskParameter="TargetOutputs" ItemName="_ResolvedProjectReference" />
    </ResolveNugetReferences>

    <Message Text="Building project %(_ResolvedProjectReference.Include) target '%(_ResolvedProjectReference.Targets)'" Condition="'%(_ResolvedProjectReference.Include)' != '' "/>
    <MSBuild Projects="%(_ResolvedProjectReference.Include)"
             Targets="%(_ResolvedProjectReference.Targets)"
             Properties="Configuration=$(Configuration);Configuration=$(Configuration);SolutionDir=$(SolutionDir)"
             ContinueOnError="$(ContinueOnError)"
             Condition="'%(_ResolvedProjectReference.Include)' != '' "/>
  </Target>
</Project>